<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>bingoJS 2</title>
    <style type="text/css">
        .bg-head {
            margin-top: 20px;
            margin-bottom: 5px;
        }

        .bg-body > * {
            margin-left: 20px;
        }
    </style>
</head>
<body bg-controller="ctrl1" style="visibility1:hidden">
    <div bg-node="node1" aaa="{{text1}}">
        aaa<div></div>
    </div>
    <div class="bg-head">text/html =================</div>
    <div class="bg-body">
        <span>text1: <span bg-text="text1" aaa="{{text1}}"></span></span>
        <div bbb="{{text1}}">text2: {{text1}}</div>
        <span>html1: <span bg-html="html1"></span></span>
    </div>
    <div class="bg-head">include =================</div>
    <div class="bg-body">
        <div bg-include="#inc1"></div>
        <div bg-include="tmpl/include"></div>
        <script type="text/html" id="inc1">
            includ:{{text1}}+100
        </script>
        <div>text1: <input bg-model="text1" /></div>
        <div>html1: <input bg-model="html1" /></div>
    </div>
    <div class="bg-head">if =================</div>
    <div class="bg-body">
        <div>
            <button bg-click="isIf = !isIf">if开关</button>
        </div>
        <div bg-if="isIf">if ok - {{text1}}</div>
    </div>
    <div class="bg-head">attr =================</div>
    <div class="bg-body">
        <label>
            <input type="checkbox" bg-checked="isOk" /> {{isOk}}
        </label>
        <div bg-attr="{a:1, b:isOk}">attr b {{isOk}}</div>
    </div>
    <div class="bg-head">event =================</div>
    <div class="bg-body">
        <button bg-click="click1">点击</button>
        <button bg-click="changeSt" bg-style="console.log({color:color1}),{color:color1}">css {{color1}}</button>
    </div>
    <div class="bg-head">model =================</div>
    <div class="bg-body">
        <div><input type="text" bg-model="model.input" />{{ console.log('model.input', model.input),model.input}}</div>
        <div><input type="checkbox" bg-checked="model.checked" />{{model.checked}}</div>
        <div>
            <label><input type="radio" name="tradio" value="1" bg-model="model.radio" />1111</label>
            <label><input type="radio" name="tradio" value="2" bg-model="model.radio" />2222</label>
        </div>
        <div>
            <select bg-model="model.radio">
                <option value="1">1111</option>
                <option value="2">2222</option>
            </select>
        </div>
        <div>
            <select bg-model="model.selectM" multiple>
                <option value="1">1111</option>
                <option value="2">2222</option>
            </select>
        </div>
        <div>结果：</div>
        <textarea style="width:60%;height:50px;" bg-prop="{value:JSON.stringify(model)}"></textarea>
    </div>
    <div class="bg-head">for =================</div>
    <div class="bg-body">
        <div bg-for="item in list1">
            <div>
                {{item.id}}:{{item.text}}
                <button bg-click="rmList($index)">删除</button>
                <button bg-click="setList($index)">重设行</button>
                <button bg-click="setListText($index)">重设text</button>
            </div>
        </div>
        <div>
            <button bg-click="addList">添加行</button>
        </div>
    </div>

    <div class="bg-head">route =================</div>
    <div class="bg-body">
        <div bg-route="routes/route1" bg-name="routeTest"></div>
    </div>

    <div class="bg-head">component =================</div>
    <div class="bg-body">
        <div bg-component="select" bg-name="select1"></div>
        <div bg-component="comp/select2" bg-name="select2"></div>

        <bg:component bg-src="select" bg-name="select3"></bg:component>
        <bg:component bg-src="comp/select2" bg-name="select4"></bg:component>
    </div>

    <script src="../scripts/bingo2/bingo.js"></script>
    <script src="route.js"></script>
    <script type="text/javascript">

        console.time('boot');
        bingo.rootView().$readyAll(function () {
            console.log('rootview readyall');
            console.timeEnd('boot');
        });
        bingo.rootView().$ready(function () {
            console.log('rootview ready');
            //console.timeEnd('boot');
        });
        bingo.ready(function () { console.log('bingo.ready'); });
        var ctrl1 = bingo.controller(function ($view, $comp, node) {
            //var $node = $(node);
            console.log('ctrl1');
            //return;
            console.log('cp select1', $comp('select1'));///, $comp('select1').datas);
            //console.log('cp select2', $comp('select2'), $comp('select2').datas);
            console.log('cp select4', $comp('select4'));//, $comp('select4').datas);
            //$comp('select3').id = '12';

            $view.$initData(function () {
                console.log('++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++');
                return '$init';
            });

            $view.$ready(function () {
                console.log('$view.$ready');
                //$node.css('visibility', 'visible');
            });
            $view.$readyAll(function () {
                console.log('$view.$readyAll');
            });


            window.$view = $view;
            $view.node1 = null;
            $view.text1 = 'hello world!'
            $view.html1 = '{{text1}}<br /> html'
            $view.isIf = true;
            $view.isOk = true;
            $view.click1 = function () {
                $view.isOk = !$view.isOk;
            };
            $view.color1 = 'blue';
            $view.changeSt = function () {
                $view.color1 = $view.color1 == 'blue' ? 'red' : 'blue';
            };

            $view.model = {
                input: '1',
                checked: true,
                radio: '1',
                selectM:['2']
            };

            $view.list1 = [{ id: '1', text: '1111' }, { id: '2', text: '2222' }];
            $view.addList = function () {
                var id = bingo.makeAutoId();
                $view.list1.push({ id: id, text: 'text_' + id });
            };
            $view.rmList = function (index) {
                $view.list1.splice(index, 1);
            };
            $view.setList = function (index) {
                var id = bingo.makeAutoId();
                $view.list1[index] = { id: id, text: 'text_' + id };
            };
            $view.setListText = function (index) {
                $view.list1[index].text = 'text_' + bingo.makeAutoId();
            }

            $view.bgOnDispose(function () {
                console.log('dispose view');
            });
        });

        (function () {
            window.reportView = function (view, isJson) {

                var trView = function (list, views) {
                    bingo.each(views, function () {
                        var v = {
                            ctrl: this._ctrlname,
                            vNode: this._bgpri_.vNode,
                            children: []
                        };
                        list.push(v);
                        var vNodes = [];
                        trNode(vNodes, [this._bgpri_.vNode]);
                        v.vNode = vNodes[0];
                        trView(v.children, this._bgpri_.children);
                    });
                }, trNode = function (vList, vNodes) {
                    bingo.each(vNodes, function () {
                        var node = {
                            attrA:[],
                            attrs: [],
                            textA: [],
                            texts: [],
                            children: []
                        };
                        vList.push(node);
                        trAttr(node.attrs, this.attrList);
                        bingo.each(node.attrs, function () {
                            node.attrA.push([this.name, this.content, this.priority].join('='));
                        });
                        node.attrA = node.attrA.join(',  ');
                        trText(node.texts, this._textList);
                        bingo.each(node.texts, function () {
                            node.textA.push([this.name, this.content, this.type].join('='));
                        });
                        node.textA = node.textA.join(',  ');
                        trNode(node.children, this.children);
                    });
                }, trAttr = function (atList, attrs) {
                    bingo.each(attrs, function () {
                        var ar = {
                            type: this.type,
                            name: this.name,
                            command: this.command,
                            priority: this.priority,
                            withData: this.withData,
                            content: this.content,
                        };
                        atList.push(ar);
                    });
                }, trText = function (tList, texts) {
                    bingo.each(texts, function () {
                        var t = {
                            type: this.type,
                            name: this.name,
                            content: this.content,
                        };
                        tList.push(t);
                    });
                };
                view || (view = bingo.rootView());
                var rlist = [];
                trView(rlist, [view]);
                return rlist;
            };

        })();


        //定义组件select
        var select = bingo.component({
            $tmpl: '<select style="visibility:visible" bg-for="item in datas" bg-model="id"><option value="{{item[idName]}}">{{item[idName]}}!{{bingo.htmlEncode(item[textName])}}</option></select>',
            $init: function () {
                console.log('comp select init', this.$parentView());
                //$(this.$getNode()).css('visibility', 'visible');
                this.$observe('id', function (c) {
                    console.log(c);
                    this.bgTrigger('onChange', [c]);
                });
            },
            idName: 'id', textName: 'text',
            id: '1',
            datas: [{ id: '1', text: 'text1' }, { id: '12', text: 'text12' }],
            onChange: function (fn) {
                return this.bgOn('onChange', fn);
            }
        });


    </script>
</body>
</html>
